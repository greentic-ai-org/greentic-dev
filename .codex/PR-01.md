PR 1 — greentic-dev: Replace reimplemented logic with pure pass-through + contract tests
Goal

Turn greentic-dev into a thin orchestrator that:

never reimplements flow/component/pack/runner semantics

shells out to the canonical binaries (greentic-flow, greentic-component, greentic-pack, greentic-runner, etc.)

includes contract tests that compare “dev wrapper” vs “direct binary” to prevent future drift

on failure, defaults to diagnosing pass-through vs upstream bug, not adding logic to make tests green.

Non-goals

Do not “fix” upstream behavior inside greentic-dev.

Do not add manifest parsing / flow generation / schema inference in greentic-dev.

Work items
0) Repo overview + baseline

Update .codex/repo_overview.md (Repo Overview Maintenance routine).

Identify current subcommands that reimplement logic (component build, flow add-step, pack, etc.).

Inventory current tests: which are “domain behavior tests” (must be deleted/moved).

1) Add a single pass-through execution core

Create a new internal module (name suggestion): src/passthrough.rs implementing:

resolve_binary(name: &str) -> PathBuf

resolution order:

explicit env override: GREENTIC_DEV_BIN_<NAME> (e.g. GREENTIC_DEV_BIN_GREENTIC_COMPONENT)

workspace target/*/ if present (optional)

PATH lookup

Fail with a crisp error that shows how to fix (install/build/set env).

run_passthrough(bin: &Path, args: &[OsString], env_passthrough: bool) -> ExitStatus

forwards:

args verbatim

stdin/stdout/stderr as-is

working directory

environment (plus only opt-in additions like RUST_LOG if user asked)

returns exit code exactly

when --verbose, prints:

resolved binary path

--version output (best-effort, do not fail if unavailable)

full command line

2) Rewire commands to pass-through (NO domain logic)

For each of these, remove local behavior and replace with direct calls:

greentic-dev flow … → greentic-flow …

greentic-dev component … → greentic-component …

greentic-dev pack … → greentic-pack …

greentic-dev runner … → greentic-runner …

Important: preserve CLI UX, but don’t modify semantics. If greentic-dev previously had extra flags, either:

keep them only if they do not affect semantics (e.g. --verbose)

or deprecate them with a message directing users to the upstream binary.

3) Add “provenance” reporting

Add a greentic-dev doctor (or extend existing) that reports:

resolved binaries + paths + versions

key env vars used for resolution

workspace detection (if you support local target resolution)

This is a debugging accelerator and makes failures actionable.

4) Add contract tests (the enforcement mechanism)

Create integration tests that assert dev wrapper == direct binary.

Suggested pattern for each command tested:

Build or locate the upstream binary (in CI use workspace-built bins)

Run upstream command directly with args

Run greentic-dev with the matching subcommand + same args

Assert:

same exit code

same stdout/stderr (normalize only unavoidable noise like absolute paths)

if outputs are files/artifacts, compare checksums or structured equality

Start with 10 highest value commands you actually use, e.g.:

flow add-step (or equivalent)

component build

component flow update

pack build

pack run

any other hot path in your e2e

5) Delete or move “domain behavior” tests

Remove tests in greentic-dev that validate behavior that belongs to upstream repos.

Replace them with the contract tests above.

6) Guardrails: prevent drift / patch-arounds

Add a CI job or test that fails if greentic-dev touches “domain logic” areas again.

Implementation options:

Simple: denylist file patterns in CI (e.g. rg -n "schemars|serde_json::Value.*manifest|flow.*emit|resolve_operation" in certain modules)

Better: restructure code so there is no module that even could contain domain logic; only passthrough/orchestration modules exist.

7) Docs

Update README/help text: “greentic-dev is a wrapper/orchestrator; the source of truth is upstream CLIs.”

Add a debugging section: “How to see which binary is executed.”

8) Finalization

Run ci/local_check.sh

Ensure contract tests are stable on macOS + linux

Ensure error messages are crisp and actionable.

Acceptance criteria

greentic-dev no longer regenerates dev_flows, no longer injects tool fields, no longer resolves operations.

Contract tests exist and fail if greentic-dev diverges from upstream.

A failure produces a clear diagnosis path: “wrapper mismatch” vs “upstream bug”.